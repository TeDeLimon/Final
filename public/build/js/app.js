let paso=1,enlaceUsado=!1;const cita={idUsuario:"",idMesa:"1",comensales:"1",fecha:"",hora:"",comentarios:"Sin comentarios"};function API(){document.querySelector("#sendAPI").addEventListener("click",guardarCita)}function comentarios(){const e=document.querySelector("#comentarios");e.addEventListener("input",(function(){cita.comentarios=e.value}))}function usuario(){const e=document.getElementById("id");cita.idUsuario=e.value}async function consultarAPI(){try{const e="https://lit-escarpment-69425.herokuapp.com/api/mesas",a=await fetch(e),o=await a.json();await mostrarServicios(o)}catch(e){console.log(e)}}function buscarPorHoraFechaComensal(){const e=document.querySelector("#fecha"),a=document.querySelectorAll(".hora"),o=document.querySelectorAll(".comensal");comensalSeleccionado=cita.comensales,o.forEach(e=>{e.addEventListener("click",(function(a){document.querySelector(".seleccionadoComensal").classList.remove("seleccionadoComensal"),e.classList.add("seleccionadoComensal"),comensalSeleccionado=a.target.innerText,cita.comensales=comensalSeleccionado}))}),a.forEach(o=>{o.addEventListener("click",(function(c){a.forEach(e=>{e.classList.remove("seleccionadoFecha")}),o.classList.add("seleccionadoFecha"),horaSeleccionada=c.target.innerText,""!=e.value&&(cita.fecha="",cita.hora="",cita.idMesa="",nuevoServicio(e.value,horaSeleccionada))}))})}async function nuevoServicio(e,a){cita.fecha=e,cita.hora=a;const o=new FormData;o.append("fecha",e),o.append("hora",a);try{const e="https://lit-escarpment-69425.herokuapp.com/api/mesas",a=await fetch(e,{method:"POST",body:o}),c=await a.json(),t=document.querySelector("#mesas");for(;t.firstChild;)t.removeChild(t.firstChild);await mostrarServicios(c)}catch(e){console.log("desde error")}}async function mostrarServicios(e){e.mesas.forEach(e=>{const{id:a,capacidad:o,estado:c}=e,t=document.createElement("P");t.classList.add("capacidad-mesas"),t.textContent=o;const s=document.createElement("DIV");s.classList.add("mesa"),s.dataset.idServicio=a,("reservada"==c||o>parseInt(comensalSeleccionado)+2||o<comensalSeleccionado)&&s.classList.add("reservada"),s.appendChild(t),document.querySelector("#mesas").appendChild(s),s.onclick=function(){seleccionarServicio(e)}})}function seleccionarServicio(e){const{id:a}=e,{estado:o}=e,c=document.querySelector(`[data-id-servicio="${a}"]`);if("disponible"!=o||c.classList.contains("seleccionadoMesa")||""!=cita.idMesa){if("disponible"==o&&""!=cita.idMesa){document.querySelector(".seleccionadoMesa").classList.remove("seleccionadoMesa"),c.classList.add("seleccionadoMesa"),cita.idMesa=a}}else c.classList.add("seleccionadoMesa"),cita.idMesa=a;console.log(cita)}async function guardarCita(){let e=!1;for(const[a,o]of Object.entries(cita))""==o&&(e=!0);if(0==e&&0==enlaceUsado){const e=new FormData;e.append("clientes_id",cita.idUsuario),e.append("mesas_id",cita.idMesa),e.append("comensales",cita.comensales),e.append("fecha",cita.fecha),e.append("hora",cita.hora),e.append("comentarios",htmlEntities(cita.comentarios)),enlaceUsado=!0;try{const a="https://lit-escarpment-69425.herokuapp.com/api/guardar",o=await fetch(a,{method:"POST",body:e});(await o.json()).resultado&&Swal.fire({position:"center",icon:"success",title:"Reserva confirmada",showConfirmButton:!1,timer:2500}).then(()=>{window.location.replace("https://lit-escarpment-69425.herokuapp.com/bookings")})}catch(e){console.log("desde error")}}else Swal.fire("Por favor revisa que todos los campos est√©n completados o enlace ya usado")}function htmlEntities(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}document.addEventListener("DOMContentLoaded",(function(){usuario(),comentarios(),API(),buscarPorHoraFechaComensal()}));
//# sourceMappingURL=app.js.map
