{"version":3,"sources":["comanda.js"],"names":["idReserva","idPlato","patron","RegExp","carrito","seleccionarTipo","document","querySelectorAll","forEach","tipo","addEventListener","e","mostrarTipo","target","id","seleccionarPlato","querySelector","classList","remove","tipoActivo","papaNode","parentNode","add","plato","dataset","botonMas","index","masPlato","value","botonMenos","menosPlato","input","botonesCantidad","botonCantidad","test","botonesComanda","botonComanda","idBoton","enviarPlato","agregarComanda","carritoPlato","nombre","cantidad","precio","ruta","innerText","parseInt","src","evaluarComanda","objeto","some","values","console","log","item","push","mostrarComanda","resumen","firstChild","removeChild","totalPrecio","contenedorPlato","createElement","imagenPlato","innerHTML","appendChild","contenedorInformacion","nombreBotonContenedor","nombrePlato","textContent","botonEliminar","botonEliminarPlato","cantidadPrecioContenedor","cantidadPlato","precioPlato","divPrecioTotal","botonCocina","length","filter","targets","enviarComanda","async","datos","FormData","append","JSON","stringify","url","respuesta","fetch","method","body","json","resultado","Swal","fire","position","icon","title","showConfirmButton","timer","then","botonPagar","error","pagar","pagarComanda","comprobarCarrito","result","id_Reserva"],"mappings":"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","file":"comanda.js","sourcesContent":["let patron = new RegExp('^[0-9]$');\r\nlet idReserva;\r\nlet idPlato;\r\nlet carrito = [];\r\n\r\ndocument.addEventListener('DOMContentLoaded', function() { \r\n    botonMas();\r\n    botonMenos();\r\n    botonesComanda();\r\n    botonesCantidad();\r\n    botonCocina();\r\n    seleccionarTipo(); //Seleccionamos los divs con los tipos de platos\r\n    const id_Reserva = document.querySelector('#idReserva');\r\n    idReserva = id_Reserva.innerText;\r\n    console.log(idReserva);\r\n});\r\nfunction seleccionarTipo() {\r\n    const tipos = document.querySelectorAll('.tipo-plato');\r\n    tipos.forEach(tipo => {\r\n        tipo.addEventListener('click', function(e){\r\n            mostrarTipo(e.target);\r\n        });\r\n    });\r\n}\r\nfunction mostrarTipo(tipo) {\r\n    const id = tipo.id;\r\n\r\n    seleccionarPlato(id);\r\n    \r\n    const anteriorActivo = document.querySelector('.tipo-plato-activo');\r\n    anteriorActivo.classList.remove('tipo-plato-activo');\r\n\r\n    const tipoActivo = document.querySelector(`#${id}`);\r\n    papaNode = tipoActivo.parentNode;\r\n    papaNode.classList.add('tipo-plato-activo');\r\n}\r\nfunction seleccionarPlato(id) {\r\n    const platos = document.querySelectorAll('.platos');\r\n    platos.forEach( plato => {\r\n        plato.classList.add('oculto');\r\n        plato.addEventListener('click', function(e) {\r\n            idPlato = plato.dataset.idPlato;\r\n        });\r\n    });\r\n    const seleccionadoPlato =document.querySelector(`.${id}`);\r\n    seleccionadoPlato.classList.remove('oculto');\r\n}\r\nfunction botonMas() {\r\n    const botonesMas = document.querySelectorAll('#boton-mas');\r\n    botonesMas.forEach( botonMas => {\r\n        botonMas.addEventListener('click', function() {\r\n            index = botonMas.dataset.masPlato;\r\n            const input = document.querySelector(`[data-cantidad-plato=\"${index}\"]`);\r\n            input.value++;\r\n        });\r\n    });\r\n}\r\nfunction botonMenos() {\r\n    const botonesMenos = document.querySelectorAll('#boton-menos');\r\n    botonesMenos.forEach( botonMenos => {\r\n        botonMenos.addEventListener('click', function() {\r\n            index = botonMenos.dataset.menosPlato;\r\n            const input = document.querySelector(`[data-cantidad-plato=\"${index}\"]`);\r\n            if(input.value > 0) input.value--;\r\n        });\r\n    });\r\n}\r\nfunction botonesCantidad() {\r\n    const botonesCantidad = document.querySelectorAll('#plato-cantidad');\r\n    botonesCantidad.forEach( botonCantidad => {\r\n        botonCantidad.addEventListener('input', function() {;\r\n            if(botonCantidad.value < 0) botonCantidad.value = '';\r\n            if (!patron.test(botonCantidad.value)) botonCantidad.value = '';\r\n        });\r\n    });\r\n}\r\nfunction botonesComanda() {\r\n    const botonesComanda = document.querySelectorAll('#boton-comanda');\r\n    botonesComanda.forEach( botonComanda => {\r\n        botonComanda.addEventListener('click', function() {\r\n            idBoton = botonComanda.dataset.enviarPlato;\r\n            agregarComanda(idBoton);\r\n        });\r\n    });\r\n}\r\nfunction agregarComanda(id) {\r\n    var carritoPlato = {\r\n        id : '',\r\n        nombre : '',\r\n        cantidad : '',\r\n        precio : '',\r\n        ruta : ''\r\n    }\r\n    carritoPlato.id = id;\r\n    carritoPlato.nombre = document.querySelector(`[data-nombre-plato=\"${id}\"]`).innerText;\r\n    carritoPlato.cantidad = parseInt(document.querySelector(`[data-cantidad-plato=\"${id}\"]`).value);\r\n    carritoPlato.precio = parseInt(document.querySelector(`[data-precio-plato=\"${id}\"]`).innerText);\r\n    carritoPlato.ruta = document.querySelector(`[data-ruta-plato=\"${id}\"]`).src;\r\n    if(carritoPlato.cantidad != 0) {\r\n        evaluarComanda(carritoPlato);\r\n        document.querySelector(`[data-cantidad-plato=\"${id}\"]`).value = 0;\r\n    }\r\n}\r\nfunction evaluarComanda(objeto) {\r\n    if(carrito.some( values => values.id == objeto.id)) {\r\n        console.log('El objecto ya existe, actualizamos la cantidad');\r\n        carrito.forEach( item => {\r\n            if(item.id == objeto.id) {\r\n                item.cantidad = item.cantidad + objeto.cantidad;\r\n            }\r\n        });\r\n    } else {\r\n        carrito.push(objeto);\r\n    }\r\n    mostrarComanda();\r\n}\r\nfunction mostrarComanda() {\r\n\r\n    console.log('Desde mostrarComanda',carrito);\r\n    const resumen = document.querySelector('.objetos-carrito');\r\n\r\n    while(resumen.firstChild) {\r\n        resumen.removeChild(resumen.firstChild);\r\n    }\r\n    var totalPrecio = 0;\r\n    carrito.forEach( plato => {\r\n        const { id, nombre, cantidad, precio, ruta } = plato;\r\n        totalPrecio = totalPrecio + precio*cantidad;\r\n\r\n        const contenedorPlato = document.createElement('DIV'); //Contenedor principal de los platos\r\n        contenedorPlato.classList.add('contenedor-plato');\r\n\r\n            const imagenPlato = document.createElement('DIV');\r\n            imagenPlato.classList.add('contenedor-foto');\r\n            imagenPlato.innerHTML = `\r\n                <img class=\"foto-plato\" src=\"${ruta}\" alt=\"Imagen ${nombre}\"/>\r\n            `;\r\n\r\n        contenedorPlato.appendChild(imagenPlato);\r\n\r\n            const contenedorInformacion = document.createElement('DIV'); //Contenedor donde va el nombre, el precio, la cantidad y el botón de eliminar\r\n            contenedorInformacion.classList.add('contenedor-informacion');\r\n\r\n                const nombreBotonContenedor = document.createElement('DIV');\r\n                nombreBotonContenedor.classList.add('nombre-boton-contenedor');\r\n\r\n                    const nombrePlato = document.createElement('P');\r\n                    nombrePlato.classList.add('nombre-plato');\r\n                    nombrePlato.textContent = nombre;\r\n\r\n                    const botonEliminar = document.createElement('BUTTON');\r\n                    botonEliminar.classList.add(`boton-${id}`);\r\n                    botonEliminar.textContent = 'X';\r\n                    botonEliminar.addEventListener('click',function() {\r\n                        botonEliminarPlato(id);\r\n                    });\r\n                    nombreBotonContenedor.appendChild(nombrePlato);\r\n                    nombreBotonContenedor.appendChild(botonEliminar);\r\n                \r\n                const cantidadPrecioContenedor = document.createElement('DIV');\r\n                cantidadPrecioContenedor.classList.add('cantidad-precio-contenedor');\r\n\r\n                    const cantidadPlato = document.createElement('P');\r\n                    cantidadPlato.classList.add('cantidad-plato');\r\n                    cantidadPlato.textContent = 'Cantidad: ' + cantidad;\r\n\r\n                    const precioPlato = document.createElement('P');\r\n                    precioPlato.classList.add('precio-plato');\r\n                    precioPlato.textContent = 'Precio: ' + cantidad*precio + '€';\r\n\r\n                    cantidadPrecioContenedor.appendChild(cantidadPlato);\r\n                    cantidadPrecioContenedor.appendChild(precioPlato);\r\n\r\n            \r\n            contenedorInformacion.appendChild(nombreBotonContenedor);\r\n            contenedorInformacion.appendChild(cantidadPrecioContenedor);\r\n\r\n        contenedorPlato.appendChild(contenedorInformacion);\r\n\r\n        resumen.appendChild(contenedorPlato);\r\n    });\r\n    \r\n    const divPrecioTotal = document.querySelector('.precio-total');\r\n        while(divPrecioTotal.firstChild) {\r\n            divPrecioTotal.removeChild(divPrecioTotal.firstChild);\r\n        }\r\n        divPrecioTotal.textContent = totalPrecio + '€';\r\n    \r\n    //Por otra parte tenemos el código para mostrar los botones\r\n    const botonCocina = document.querySelector('.cocina');\r\n    if(carrito.length == 0) botonCocina.classList.add('oculto');\r\n    if(carrito.length > 0 ) botonCocina.classList.remove('oculto');\r\n}\r\n\r\nfunction botonEliminarPlato(id) {\r\n    carrito = carrito.filter( targets => targets.id != id);\r\n    mostrarComanda();\r\n}\r\n\r\nfunction botonCocina() {\r\n    const botonCocina = document.querySelector('.cocina');\r\n    botonCocina.addEventListener('click', function() {\r\n        enviarComanda(); \r\n    });\r\n}\r\nasync function enviarComanda() {\r\n    datos = new FormData();\r\n    datos.append('carrito', JSON.stringify(carrito));\r\n    datos.append('reserva',idReserva);\r\n    try {\r\n        const url = 'http://localhost:300/api/comanda';\r\n        const respuesta = await fetch(url, {\r\n            method: 'POST',\r\n            body: datos\r\n        });\r\n        const result = await respuesta.json();\r\n        if(result.resultado) {\r\n            Swal.fire({\r\n            position: 'center',\r\n            icon: 'success',\r\n            title: '¡Comanda enviada a cocina!',\r\n            showConfirmButton: false,\r\n            timer: 2500\r\n            }).then( () => {\r\n                botonPagar();\r\n                carrito = [];\r\n                mostrarComanda();\r\n            })\r\n        }\r\n    } catch (error) {\r\n        console.log('Desde error');\r\n    }\r\n}\r\nfunction botonPagar() {\r\n    const botonPagar = document.querySelector('.pagar');\r\n    const pagar = document.querySelector('#pagar');\r\n    botonPagar.classList.remove('oculto');\r\n    pagar.addEventListener('click', function() {\r\n        pagarComanda();\r\n    });\r\n}\r\nasync function comprobarCarrito() {\r\n    try {\r\n        const url = 'http://localhost:300/api/existeComanda';\r\n        const respuesta = await fetch(url);\r\n        const result = await respuesta.json();\r\n        console.log(result);\r\n    } catch (error) {\r\n\r\n    }\r\n}\r\nasync function pagarComanda() {\r\n\r\n}"]}